{
    "author": "NBU-system-sw-dev-ops-support@nvidia.com",
    "notify": "$gitlabUserEmail, air-dev@exchange.nvidia.com",
    "timeout": "1",
    "durability_mode": "MAX_SURVIVABILITY",
    "agentConfig": [
        {
            "type": "pod",
            "templateFile": "ngci_build/common/dev-tools-pod.yaml",
            "label": "POD_AIR"
        },
        {
            "type": "pod",
            "templateFile": "ngci_build/common/air-dind-pod.yaml",
            "label": "DIND"
        }
    ],
    "properties": [
        "build_propertiesFile=ngci_build/common/build.properties"
    ],
    "phases": [
        {
            "phase_1": [
                {
                    "name": "Clone component for Validation",
                    "module": "com.mellanox.jenkins.generic_modules.Checkout",
                    "category": "validation",
                    "container": "build-python:POD_AIR",
                    "parameters": {
                        "CLONE_PATH": "air_sdk",
                        "CREDENTIALSID": "${CREDENTIALSID}",
                        "GIT_REPOSITORY": "${COMPONENT_REPO}",
                        "BRANCH_NAME": "${BRANCH_NAME}"
                    },
                    "skip": false,
                    "on_failure": "stop"
                },
                {
                    "name": "Version validation",
                    "module": "ngci_build/modules/validation.groovy",
                    "category": "validation",
                    "container": "build-python:POD_AIR",
                    "parameters": {},
                    "skip": false,
                    "on_failure": "stop"
                }
            ]
        },
        {
            "phase_2": [
                {
                    "name": "Clone component",
                    "module": "com.mellanox.jenkins.generic_modules.Checkout",
                    "category": "Clone",
                    "container": "build-static:POD_AIR@static,build-python:POD_AIR@lint,build-python:POD_AIR@unit",
                    "parameters": {
                        "CLONE_PATH": "air_sdk",
                        "CREDENTIALSID": "${CREDENTIALSID}",
                        "GIT_REPOSITORY": "${COMPONENT_REPO}",
                        "BRANCH_NAME": "${BRANCH_NAME}"
                    },
                    "skip": false,
                    "on_failure": "stop"
                },
                {
                    "name": "Static",
                    "module": "com.mellanox.jenkins.generic_modules.RunCmd",
                    "category": "Test",
                    "container": "build-static:POD_AIR@static",
                    "parameters": {
                        "cmd": "semgrep-agent --config p/r2c-ci"
                    },
                    "skip": false,
                    "on_failure": "stop",
                    "out_of_mail": false
                },
                {
                    "name": "Lint",
                    "module": "com.mellanox.jenkins.generic_modules.RunCmd",
                    "category": "Test",
                    "container": "build-python:POD_AIR@lint",
                    "parameters": {
                        "cmd": "pip install -r requirements-dev.txt && pylint **/*.py"
                    },
                    "skip": false,
                    "on_failure": "stop",
                    "out_of_mail": false
                },
                {
                    "name": "Unit",
                    "module": "ngci_build/modules/python-basic.groovy",
                    "category": "Test",
                    "container": "build-python:POD_AIR@unit",
                    "parameters": {
                        "pip_install": "-r requirements-dev.txt",
                        "cmd": "python3 -m coverage run --omit='tests/*,**/__init__.py,main.py' --source='./' -m pytest tests/*.py",
                        "coverage_report" : true,
                        "publish_html_dir": "htmlcov",
                        "publish_html_files": "index.html",
                        "report_name": "Unit Test Coverage Report"
                    },
                    "skip": false,
                    "on_failure": "stop"
                }


            ]
        },
        {
            "phase_3": [
                {
                    "name": "Clone component for Build",
                    "module": "com.mellanox.jenkins.generic_modules.Checkout",
                    "category": "Clone",
                    "container": "build-python:POD_AIR",
                    "parameters": {
                        "CLONE_PATH": "air_sdk",
                        "CREDENTIALSID": "${CREDENTIALSID}",
                        "GIT_REPOSITORY": "${COMPONENT_REPO}",
                        "BRANCH_NAME": "${BRANCH_NAME}"
                    },
                    "skip": false,
                    "on_failure": "stop"
                },
                {
                    "name": "Tagging",
                    "module": "ngci_build/modules/tagging.groovy",
                    "category": "Tagging",
                    "container": "build-python:POD_AIR",
                    "parameters": {},
                    "skip": false,
                    "on_failure": "stop"
                }
            ]
        }
    ]
}
